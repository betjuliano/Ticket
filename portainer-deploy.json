{
  "Name": "ticket-system",
  "SwarmID": "",
  "ComposeFile": "version: '3.8'\n\nservices:\n  # Traefik - Reverse Proxy e Load Balancer\n  traefik:\n    image: traefik:v3.0\n    container_name: ticket-traefik\n    restart: unless-stopped\n    command:\n      # Configurações globais\n      - --global.checkNewVersion=false\n      - --global.sendAnonymousUsage=false\n      \n      # Configurações da API\n      - --api.dashboard=true\n      - --api.debug=true\n      \n      # Configurações dos entrypoints\n      - --entrypoints.web.address=:80\n      - --entrypoints.websecure.address=:443\n      \n      # Redirecionamento HTTP para HTTPS\n      - --entrypoints.web.http.redirections.entrypoint.to=websecure\n      - --entrypoints.web.http.redirections.entrypoint.scheme=https\n      - --entrypoints.web.http.redirections.entrypoint.permanent=true\n      \n      # Configurações do Docker provider\n      - --providers.docker=true\n      - --providers.docker.exposedbydefault=false\n      - --providers.docker.network=ticket-network\n      \n      # Configurações do Let's Encrypt\n      - --certificatesresolvers.letsencrypt.acme.tlschallenge=true\n      - --certificatesresolvers.letsencrypt.acme.email=${ACME_EMAIL:-admin@seudominio.com}\n      - --certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json\n      \n      # Configurações de logs\n      - --log.level=INFO\n      - --accesslog=true\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n      - \"8080:8080\" # Dashboard do Traefik\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n      - traefik-letsencrypt:/letsencrypt\n    networks:\n      - ticket-network\n    labels:\n      # Dashboard do Traefik\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.traefik.rule=Host(`${TRAEFIK_DOMAIN:-traefik.localhost}`)\"\n      - \"traefik.http.routers.traefik.entrypoints=websecure\"\n      - \"traefik.http.routers.traefik.tls.certresolver=letsencrypt\"\n      - \"traefik.http.routers.traefik.service=api@internal\"\n      \n      # Middleware de autenticação básica para o dashboard\n      - \"traefik.http.middlewares.traefik-auth.basicauth.users=${TRAEFIK_AUTH:-admin:$$2y$$10$$K8V2VKDKHsOKOcUuLcGOOOqNdKXqk8rKEWOjFuQOQOQOQOQOQOQOQO}\"\n      - \"traefik.http.routers.traefik.middlewares=traefik-auth\"\n\n  # PostgreSQL - Banco de dados\n  postgres:\n    image: postgres:15-alpine\n    container_name: ticket-postgres\n    restart: unless-stopped\n    ports:\n      - \"5432:5432\"\n    environment:\n      POSTGRES_DB: ${POSTGRES_DB:-ticket_db}\n      POSTGRES_USER: ${POSTGRES_USER:-ticket_user}\n      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-ticket_password}\n      PGDATA: /var/lib/postgresql/data/pgdata\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n      - ./init-db.sql:/docker-entrypoint-initdb.d/init-db.sql:ro\n    networks:\n      - ticket-network\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U ${POSTGRES_USER:-ticket_user} -d ${POSTGRES_DB:-ticket_db}\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 30s\n\n  # Redis - Cache e sessões\n  redis:\n    image: redis:7-alpine\n    container_name: ticket-redis\n    restart: unless-stopped\n    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-redis_password}\n    volumes:\n      - redis-data:/data\n    networks:\n      - ticket-network\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"--raw\", \"incr\", \"ping\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 30s\n\n  # Aplicação Ticket System\n  ticket-app:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    container_name: ticket-app\n    restart: unless-stopped\n    environment:\n      # Configurações da aplicação\n      NODE_ENV: production\n      NEXT_PUBLIC_APP_NAME: \"Ticket System\"\n      NEXT_PUBLIC_APP_VERSION: \"2.1.7\"\n      NEXT_PUBLIC_APP_ENV: \"production\"\n      NEXT_PUBLIC_APP_URL: \"https://${DOMAIN:-localhost}\"\n      \n      # Configurações de banco de dados\n      DATABASE_URL: \"postgresql://${POSTGRES_USER:-ticket_user}:${POSTGRES_PASSWORD:-ticket_password}@postgres:5432/${POSTGRES_DB:-ticket_db}\"\n      REDIS_URL: \"redis://:${REDIS_PASSWORD:-redis_password}@redis:6379\"\n      \n      # Configurações de autenticação\n      NEXTAUTH_SECRET: ${NEXTAUTH_SECRET:-your-super-secret-key-here}\n      NEXTAUTH_URL: \"https://${DOMAIN:-localhost}\"\n      \n      # Configurações de email\n      SMTP_HOST: ${SMTP_HOST:-smtp.gmail.com}\n      SMTP_PORT: ${SMTP_PORT:-587}\n      SMTP_USER: ${SMTP_USER:-}\n      SMTP_PASS: ${SMTP_PASS:-}\n      \n      # Configurações de upload\n      UPLOAD_MAX_SIZE: ${UPLOAD_MAX_SIZE:-10485760}\n      UPLOAD_ALLOWED_TYPES: ${UPLOAD_ALLOWED_TYPES:-image/jpeg,image/png,image/gif,application/pdf}\n      \n      # Configurações de logs\n      LOG_LEVEL: ${LOG_LEVEL:-info}\n      LOG_FILE: \"/app/logs/app.log\"\n      \n      # Configurações de cache\n      CACHE_TTL: ${CACHE_TTL:-3600}\n      \n      # Configurações de rate limiting\n      RATE_LIMIT_REQUESTS: ${RATE_LIMIT_REQUESTS:-100}\n      RATE_LIMIT_WINDOW: ${RATE_LIMIT_WINDOW:-900}\n    volumes:\n      - app-logs:/app/logs\n      - app-uploads:/app/uploads\n    networks:\n      - ticket-network\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n    labels:\n      # Configurações do Traefik\n      - \"traefik.enable=true\"\n      \n      # Roteamento principal\n      - \"traefik.http.routers.ticket-app.rule=Host(`${DOMAIN:-localhost}`)\"\n      - \"traefik.http.routers.ticket-app.entrypoints=websecure\"\n      - \"traefik.http.routers.ticket-app.tls.certresolver=letsencrypt\"\n      - \"traefik.http.routers.ticket-app.service=ticket-app\"\n      - \"traefik.http.services.ticket-app.loadbalancer.server.port=3000\"\n      \n      # Middlewares de segurança\n      - \"traefik.http.middlewares.ticket-security.headers.accesscontrolallowmethods=GET,OPTIONS,PUT,POST,DELETE\"\n      - \"traefik.http.middlewares.ticket-security.headers.accesscontrolalloworiginlist=https://${DOMAIN:-localhost}\"\n      - \"traefik.http.middlewares.ticket-security.headers.accesscontrolmaxage=100\"\n      - \"traefik.http.middlewares.ticket-security.headers.addvaryheader=true\"\n      - \"traefik.http.middlewares.ticket-security.headers.referrerpolicy=strict-origin-when-cross-origin\"\n      - \"traefik.http.middlewares.ticket-security.headers.framedeny=true\"\n      - \"traefik.http.middlewares.ticket-security.headers.contentTypeNosniff=true\"\n      - \"traefik.http.middlewares.ticket-security.headers.browserxssfilter=true\"\n      - \"traefik.http.middlewares.ticket-security.headers.stsincludesubdomains=true\"\n      - \"traefik.http.middlewares.ticket-security.headers.stspreload=true\"\n      - \"traefik.http.middlewares.ticket-security.headers.stsseconds=31536000\"\n      \n      # Rate limiting\n      - \"traefik.http.middlewares.ticket-ratelimit.ratelimit.average=100\"\n      - \"traefik.http.middlewares.ticket-ratelimit.ratelimit.burst=200\"\n      \n      # Aplicar middlewares\n      - \"traefik.http.routers.ticket-app.middlewares=ticket-security,ticket-ratelimit\"\n\n# Volumes persistentes\nvolumes:\n  traefik-letsencrypt:\n    driver: local\n  postgres-data:\n    driver: local\n  redis-data:\n    driver: local\n  app-logs:\n    driver: local\n  app-uploads:\n    driver: local\n\n# Rede personalizada\nnetworks:\n  ticket-network:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.0.0/16",
  "Env": [
    {
      "name": "DOMAIN",
      "value": "ticket.iaprojetos.com.br"
    },
    {
      "name": "TRAEFIK_DOMAIN",
      "value": "traefik.iaprojetos.com.br"
    },
    {
      "name": "ACME_EMAIL",
      "value": "admin@iaprojetos.com.br"
    },
    {
      "name": "POSTGRES_DB",
      "value": "ticket_db"
    },
    {
      "name": "POSTGRES_USER",
      "value": "ticket_user"
    },
    {
      "name": "POSTGRES_PASSWORD",
      "value": "ticket_password_secure_123"
    },
    {
      "name": "REDIS_PASSWORD",
      "value": "redis_password_secure_123"
    },
    {
      "name": "NEXTAUTH_SECRET",
      "value": "your-super-secret-key-here-change-this"
    }
  ]
}